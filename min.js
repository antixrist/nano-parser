"use strict";function getHash(e){for(var r=e.length,n=""+r;r--;)n+=e[r];return n}function Parser(e){this.exec=e}function find(e){if("string"==typeof e){var r=e.length;return new Parser(function(n,t){return n[t[0]].substr(t[1],r)===e?{result:e,end:[t[0],t[1]+r]}:!1})}return new Parser(function(r,n){var t=e.exec(r[n[0]].slice(n[1]));return t&&0===t.index?{result:t[0],end:[n[0],n[1]+t[0].length]}:!1})}function optional(e){return new Parser(function(r,n,t){return e.exec(r,n,t)||{result:void 0,end:n}})}function required(e){return new Parser(function(r,n,t){return e.exec(r,n,t)||error(r[n[0]],n[1])})}function conditional(e,r,n){return new Parser(function(t,i,u){return e.exec(t,i,u)?r.exec(t,i,u):n.exec(t,i,u)})}function any(){for(var e=0,r=arguments.length,n=Array(r);r>e;e++)n[e]=arguments[e];var t=n.length;return new Parser(function(e,r,i){for(var u=!1,s=0,o=t;o>s&&!u;s++)u=n[s].exec(e,r,i);return u})}function sequence(){for(var e=0,r=arguments.length,n=Array(r);r>e;e++)n[e]=arguments[e];var t=n.length;return new Parser(function(e,r,i){for(var u,s=r,o=[],c=0,a=t;a>c;c++){if(u=n[c].exec(e,s,i),!u)return!1;o.push(u.result),s=u.end}return{result:o,end:s}})}function repeat(e,r){var n=r?sequence(r,e).then(function(e){return e[1]}):e;return new Parser(function(r,t,i){for(var u=[],s=t,o=e.exec(r,s,i);o!==!1&&(o.end[1]>s[1]||o.end[0]>s[0]);)u.push(o.result),s=o.end,o=n.exec(r,s,i);return u.length>0&&{result:u,end:s}})}function defer(e){var r;return new Parser(function(n,t,i){return(r||(r=e())).exec(n,t,i)})}function error(e,r){var n=0>r-20?0:r-20;throw new Error("Unexpected symbol\n'"+e.slice(n,r)+"***"+e[r]+"***"+e.slice(r+1,r+5)+"'\nin position "+r)}function next(){return new Parser(function(e,r){if(!e[r[0]][r[1]]){var n=r[0]+1;return void 0!==e[n]?{result:r[0],end:[n,0]}:!1}return!1})}function end(){return new Parser(function(e,r){return e[r[0]][r[1]]||void 0!==e[r[0]+1]?!1:{result:r[0],end:r}})}Parser.prototype={execCached:function(e,r,n){var t=n.hash||(n.hash=getHash(e)),i=this.cache[t];return void 0===i?this.cache[t]=this.originalExec(e,r,n):i},useCache:function(e){return e=void 0===e?!0:e,e&&!this.originalExec?(this.originalExec=this.exec,this.exec=this.execCached.bind(this),this.cache=this.cache||{}):!e&&this.originalExec&&(this.exec=this.originalExec,delete this.originalExec),this},not:function(e){var r=this.exec;return new Parser(function(n,t,i){return e.exec(n,t,i)?!1:r(n,t,i)})},then:function(e){var r=this.exec;return new Parser(function(n,t,i){var u=r(n,t,i);return u&&{result:e(u.result,i.values),end:u.end}})},parse:function(e,r){var n="string"==typeof e?[e]:e,t=[0,0];return(this.exec(n,t,{values:r})||{}).result}},exports.Parser=Parser,exports.any=any,exports.conditional=conditional,exports.next=next,exports.end=end,exports.find=find,exports.optional=optional,exports.repeat=repeat,exports.required=required,exports.sequence=sequence,exports.defer=defer;